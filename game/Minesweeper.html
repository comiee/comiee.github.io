<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.staticfile.org/vue/2.2.2/vue.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <title>æ‰«é›·</title>
    <style>
        #app {
            text-align: center;
        }

        .block {
            width: 30px;
            height: 30px;
            vertical-align: middle;
            background-color: #ccc;
            border: outset;
        }
    </style>
</head>
<body>
<div id="app">
    <div id="top">
        <p style="display:inline-block">{{n}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
        <button class="block" @click="location.reload()">{{rbs}}</button>
        <p style="display:inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{t}}</p>
    </div>
    <div id="blocks" v-for="j in ys">
        <button v-for="i in xs" :id="j+'-'+i" class="block"
                @click="click_left(j-1,i-1)"
                @contextmenu="click_right($event)"></button>
        <br/>
    </div>
</div>
<script>
    new Vue({
        el: '#app',
        data: {
            xs: 9,      //æ¨ªå‘æ ¼æ•°
            ys: 9,      //çºµå‘æ ¼æ•°
            ln: 10,     //é›·çš„æ•°é‡
            n: 10,      //å·¦ä¸Šè§’æ˜¾ç¤ºçš„å‰©ä½™é›·æ•°
            t: 0,       //è®¡æ—¶
            tm:null,    //è®¡æ—¶å™¨
            rbs: "",    //é‡ç©æŒ‰é’®æ˜¾ç¤ºçš„å­—ç¬¦
            dat: [],    //æ•°æ®ï¼Œä»£è¡¨æ„ä¹‰å¦‚ä¸‹ï¼š
            // 0~8ä»£è¡¨é›·æ•°
            // 9ä»£è¡¨é›·
            // ç©ºæ ¼ä»£è¡¨è¢«ç¿»å¼€çš„0
        },
        methods: {
            //å·¦é”®äº‹ä»¶
            click_left(j, i) {
                let obj = $(`#${j + 1}-${i + 1}`);
                if (obj.text() !== '') return;
                obj.attr('disabled', 'disabled');
                obj.css('background-color', '#eee');
                obj.css('border', 'solid');
                if (this.dat[j][i] === 9) {
                    //å¤±è´¥
                    obj.text('ğŸ’£');
                    this.rbs = "ğŸ˜«";
                    obj.css('background-color', '#f00');
                    //è¿é”ç¿»å¼€æ‰€æœ‰é›·
                    for (let y = 0; y < this.ys; y++) {
                        for (let x = 0; x < this.xs; x++) {
                            if (this.dat[y][x] === 9) {
                                let o = $(`#${y + 1}-${x + 1}`);
                                if (o.text() === 'ğŸš©') {
                                    o.text('âœ”');
                                } else {
                                    this.click_left(y, x)
                                }
                            }
                        }
                    }
                    this.click_left = null;
                    this.click_right = null;
                    clearInterval(this.tm);
                } else if (this.dat[j][i] === 0) {
                    //è¿é”ç¿»å¼€å‘¨å›´æ–¹å—
                    this.dat[j][i] = ' ';
                    for (let y = j - 1; y <= j + 1; y++) {
                        for (let x = i - 1; x <= i + 1; x++) {
                            if (0 <= y && y < this.ys && 0 <= x && x < this.xs) {
                                this.click_left(y, x)
                            }
                        }
                    }
                } else {
                    obj.text(this.dat[j][i]);
                }
                //åˆ¤æ–­æ˜¯å¦èƒœåˆ©
                let flag = 1;
                for (let y = 0; y < this.ys; y++) {
                    for (let x = 0; x < this.xs; x++) {
                        s = $(`#${y + 1}-${x + 1}`).text();
                        if (s === 'ğŸš©' || s === 'â“' || s === '') {
                            if (this.dat[y][x] !== 9) {
                                flag = 0;
                                break;
                            }
                        }
                    }
                }
                if(flag){
                    this.rbs = "ğŸ˜";
                    this.click_left = null;
                    this.click_right = null;
                    clearInterval(this.tm);
                    alert('æ­å–œä½ èµ¢äº†ï¼ç”¨æ—¶'+this.t+'ç§’');
                }
            },
            //å³é”®äº‹ä»¶
            click_right(e) {
                console.log(e.target.innerText);
                switch (e.target.innerText) {
                    case '':
                        e.target.innerText = 'ğŸš©';
                        this.n--;
                        break;
                    case 'ğŸš©':
                        e.target.innerText = 'â“';
                        this.n++;
                        break;
                    case 'â“':
                        e.target.innerText = '';
                        break;
                }
            }
        },
        mounted() {
            this.rbs = "ğŸ˜Š";
            this.dat = Array.from({length: this.ys}, () => Array.from({length: this.xs}, () => 0));

            //åˆå§‹åŒ–é›·
            for (let n = this.ln; n;) {
                let j = Math.floor(Math.random() * this.ys);
                let i = Math.floor(Math.random() * this.xs);
                if (this.dat[j][i] !== 9) {
                    this.dat[j][i] = 9;
                    n--;
                }
            }
            //åˆå§‹åŒ–æ•°å­—
            for (let j = 0; j < this.ys; j++) {
                for (let i = 0; i < this.xs; i++) {
                    if (this.dat[j][i] === 9) {
                        for (let y = j - 1; y <= j + 1; y++) {
                            for (let x = i - 1; x <= i + 1; x++) {
                                if (this.dat[y] && this.dat[y][x] !== 9) {
                                    this.dat[y][x]++;
                                }
                            }
                        }
                    }
                }
            }
            //ç¦ç”¨åŸå§‹å³é”®
            document.oncontextmenu = () => false;
            this.tm=setInterval(() => this.t++, 1000);
        }
    });
</script>
</body>
</html>
